<!DOCTYPE html>
<html lang="en">

<head>

    <title>webgl2 test</title>

    <script type="text/javascript" src="./libs/utils.js"></script>
    <script type="text/javascript" src="./libs/Program.js"></script>
    <style>
        canvas {
            border: 5px dotted blue;
        }
    </style>

    <script id="vertex-shader" type="x-shader/x-vertex">
        #version 300 es
        precision mediump float;
    
        // Supplied vertex position attribute
        in vec3 aVertexPosition;
    
        void main(void) {
          // Set the position in clipspace coordinates
          gl_Position = vec4(aVertexPosition, 1.0);
        }
    
    </script>

    <script id="fragment-shader" type="x-shader/x-fragment">

        #version 300 es
        precision mediump float;

        out vec4 fragColor;

        void main(void) {
            fragColor = vec4(1.0,0.0,0.0,1.0);
        }

    </script>

    <script type="text/javascript">

        'use strict';

        let gl, program, squareVertexBuffer, squareIndexBuffer, indices;

        function initProgram() {

            program = new Program(gl, 'vertex-shader', 'fragment-shader');
           
            const attributes = ['aVertexPosition'];
            const uniforms = [];
            program.load(attributes,uniforms);

        }

        function initBuffers() {

            const vertices = [
                -0.5, 0.5, 0,
                -0.5, -0.5, 0,
                0.5, -0.5, 0,
                0.5, 0.5, 0
            ];

            indices = [0, 1, 2, 0, 2, 3];

            squareVertexBuffer = gl.createBuffer();
            gl.bindBuffer(gl.ARRAY_BUFFER, squareVertexBuffer);
            gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(vertices), gl.STATIC_DRAW);

            squareIndexBuffer = gl.createBuffer();
            gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, squareIndexBuffer);
            gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, new Uint8Array(indices), gl.STATIC_DRAW);

            gl.bindBuffer(gl.ARRAY_BUFFER, null);
            gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, null);
        }

        function draw() {
            gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);
            gl.viewport(0, 0, gl.canvas.width, gl.canvas.height);

            gl.bindBuffer(gl.ARRAY_BUFFER, squareVertexBuffer);
            gl.vertexAttribPointer(program.aVertexPosition, 3, gl.FLOAT, false, 0, 0);
            gl.enableVertexAttribArray(program.aVertexPosition);

            gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, squareIndexBuffer);
            gl.drawElements(gl.TRIANGLES, indices.length, gl.UNSIGNED_BYTE, 0);


            gl.bindBuffer(gl.ARRAY_BUFFER, null);
            gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, null);
        }

        function init() {

            const canvas = utils.getCanvas('webgl-canvas');

            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;

            gl = utils.getGLContext(canvas);

            gl.clearColor(0, 0, 0, 1);

            initProgram();
            initBuffers();
            draw();

        }

        window.onload = init;

    </script>



</head>

<body>

    <canvas id="webgl-canvas" width="800" height="600">
        your browser does not support the HTML5 canvas element.
    </canvas>

</body>

</html>